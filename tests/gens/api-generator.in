#!/bin/bash

common_includes="\
-I@abs_top_srcdir@/src/core \
-I@abs_top_srcdir@/src/apis/c \
-I@abs_top_builddir@/src/apis/c \
$END"

VERSIONS="@VERSIONS@"

@DEBUG_VERSION_TRUE@ debug_CPPFLAGS="@debug_CPPFLAGS@ @cc_dep_CPPFLAGS@ @host_dep_CPPFLAGS@ @extra_CPPFLAGS@ $common_includes"
@DEBUG_VERSION_TRUE@ debug_CXXFLAGS="@debug_CXXFLAGS@ @cc_dep_CXXFLAGS@ @host_dep_CXXFLAGS@ @extra_CXXFLAGS@"
@DEBUG_VERSION_TRUE@ debug_LDFLAGS="@cc_dep_LDFLAGS@ @host_dep_LDFLAGS@ @extra_LDFLAGS@"
@DEBUG_VERSION_TRUE@ debug_LIBADD="@extra_LIBS@"
@DEBUG_VERSION_TRUE@ debug_PLUGINS=

# Common to all versions
cat << EOF
CC=@CC@
CXX=@CXX@
EOF

# Specific to each version
for version in @VERSIONS@; do

for plugin in "@PLUGINS@"; do
  $(eval ${version}_PLUGINS="\$${version}_PLUGINS @abs_top_builddir@/src/$plugin/.libs")
done


cat <<EOF
${version}_CPPFLAGS="$(eval echo \${${version}_CPPFLAGS})"
${version}_CXXFLAGS="$(eval echo \${${version}_CXXFLAGS})"
${version}_LDFLAGS="$(eval echo \${${version}_LDFLAGS})"
${version}_LIBADD="$(eval echo \${${version}_LIBADD})"
${version}_PLUGINS="$(eval echo \${${version}_PLUGINS})"

test_LDFLAGS_$version=" -Wl,--no-as-needed \
@buildir@/pms/$version/.libs/libnanox-ompss.so \
@buildir@/core/$version/.libs/libnanox.so \
@buildir@/apis/$version/.libs/libnanox-c.so \
-pthread"

test_ENV_$version="LD_LIBRARY_PATH=\
@buildir@/core/$version/.libs:\
@buildir@/apis/$version/.libs:\
@buildir@/pms/$version/.libs:\
\$PLUGINS_$version:\$LD_LIBRARY_PATH"

\$(@srcdir@/tests/gens/config.py $*)
EOF
done;

